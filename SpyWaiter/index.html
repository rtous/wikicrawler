<div class="mw-parser-output"><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introducci.C3.B3"><span class="tocnumber">1</span> <span class="toctext">Introducció</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Tor"><span class="tocnumber">2</span> <span class="toctext">Tor</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Kubernetes"><span class="tocnumber">3</span> <span class="toctext">Kubernetes</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Integraci.C3.B3"><span class="tocnumber">4</span> <span class="toctext">Integració</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Web_Service"><span class="tocnumber">5</span> <span class="toctext">Web Service</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Avaluaci.C3.B3_de_Rendiment"><span class="tocnumber">6</span> <span class="toctext">Avaluació de Rendiment</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Conclusions"><span class="tocnumber">7</span> <span class="toctext">Conclusions</span></a></li>
</ul>
</div>
<h1><span id="Introducció"></span><span class="mw-headline" id="Introducci.C3.B3">Introducció</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=1" title="Edit section: Introducció">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=1" title="Edit section: Introducció">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>No és estrany llegir notícies de censura a Internet. El control que es du a terme sobre la xarxa no para de créixer. I sembla que el futur continuarà amb aquesta tendència. Una de les eines més populars que s’utilitza per saltar-se aquest control és Tor.
</p><p>Per una altra banda, el món dels serveis web s’ha revolucionat en els últims anys. Degut a l’augment de tràfic de la xarxa, s’ha creat la necessitat de dissenyar la web de manera escalable. D’aquesta manera, ha aparegut el concepte de containerització i de microservei. L’eina utilitzada per gestionar-ho és Kubernetes (K8s), i ha obtingut moltíssima popularitat.
</p><p>Aquest treball consisteix a dissenyar una infraestructura Kubernetes escalable i integrar-la dins de la xarxa Tor.
</p>
<h1><span class="mw-headline" id="Tor">Tor</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=2" title="Edit section: Tor">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=2" title="Edit section: Tor">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Pel que fa a Tor, hem instal·lat el servei en la màquina de la FIB. Hi hem configurat la connexió ssh i un hidden service per tal de poder accedir als dos serveis a través de la xarxa de Tor fent servir adreces <i>onion</i>. 
</p><p>Crear un hidden service ens dona l’adreça .onion mitjançant la qual podrem accedir a un determinat servei. Per tal d’indicar al servei de Tor que volem un hidden service cal que modifiquem el fitxer de configuració de Tor que es troba a: /etc/tor/torrc. Aquest fitxer, que és el de configuració de Tor i és on podem reencaminar les diferents peticions que rebem a l'adreça onion a diferents serveis que tinguem dins la màquina. Ens caldrà modificar aquest fitxer, també, per la integració amb Kubernetes.
</p><p>En el treball també expliquem com s'estableix la connexió, com el hidden service passa a ser accessible des de qualsevol client de Tor i com es manté l'anonimat de totes les parts.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:302px;"><a class="image" href="/pti/index.php/File:Tor.png"><img alt="" class="thumbimage" data-file-height="413" data-file-width="620" decoding="async" height="200" src="/pti/images/thumb/1/1f/Tor.png/300px-Tor.png" srcset="/pti/images/thumb/1/1f/Tor.png/450px-Tor.png 1.5x, /pti/images/thumb/1/1f/Tor.png/600px-Tor.png 2x" width="300"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="/pti/index.php/File:Tor.png" title="Enlarge"></a></div>Logo de Tor</div></div></div></div>
<h1><span class="mw-headline" id="Kubernetes">Kubernetes</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=3" title="Edit section: Kubernetes">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=3" title="Edit section: Kubernetes">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Cal instal·lar Kubernetes juntament amb Kubeadm, per inicialitzar el cluster de nodes, Kubelet, per inicialitzar els pods i els containers, i Kubectl, per poder controlar el cluster per linea de comandes. També hem d'instal·lar un add-on de xarxa per a que els diferents nodes es puguin connectar amb el Control-plane. Hi ha un munt d’add-on’s diferents pero nosaltres utilitzarem flannel.
</p><p>Els pods que hi ha per defecte en el nostre clúster són els següents:
</p>
<ul><li><b>kube-apiserver</b>: Es un pod que serveix per a que puguis gestionar el cluster utilitzant crides desde l’exterior.</li>
<li><b>etcd</b>: Es un pod que serveix per emmagatzemar les dades de tot el cluster.</li>
<li><b>kube-scheduler</b>: Es un pod que actua com a planificador, que pot crear nou pods i asignarlos a diferents nodes.</li>
<li><b>kube-controller-manager</b>: Es un pod que executa diferents controladors, com pot ser els dels nodes o els dels endpoints.</li>
<li><b>kubelet</b>: Es un pod que s’encarrega de que els containers s’executin dins d’un pod.</li>
<li><b>kube-proxy</b>: Es un pod que s’encarrega d’una part del Service que hi ha en el cluster.</li></ul>
<p>El deployment del nostre servei és mitjançant el tipus ClusterIP, que fa que el servei només pugui ser accedit des de dins del clúster.
</p><p>Una de les característiques del deployment de kubernetes és la capacitat d’augmentar dinàmicament el nombre de rèpliques que té. D’aquesta manera, cada deployment és molt escalable. La comanda <i>kubectl scale --replicas=X deployment/Y</i> permet fer-ho, on X és el nou nombre de rèpliques i Y el nom del deployment.
</p><p>
Una altra opció molt interessant és permetre a Kubernetes escalar dinàmicament el nombre de rèpliques segons el tràfic de la xarxa. Un exemple per definir que volem un mínim de quatre rèpliques i un màxim de deu és el següent: kubectl autoscale deployment Y --min=4 --max=10, on Y és el nom del deployment.</p><div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:362px;"><a class="image" href="/pti/index.php/File:K8s.png"><img alt="" class="thumbimage" data-file-height="210" data-file-width="360" decoding="async" height="210" src="/pti/images/d/d7/K8s.png" width="360"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="/pti/index.php/File:K8s.png" title="Enlarge"></a></div>Logo de Kubernetes</div></div></div></div>
<h1><span id="Integració"></span><span class="mw-headline" id="Integraci.C3.B3">Integració</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=4" title="Edit section: Integració">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=4" title="Edit section: Integració">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>La integració ha consistit a utilitzar un proxy. Bàsicament, disposem d’una adreça IP (privada) i d’un port específic que identifica cada servei de tipus ClusterIP. Per tant, cal un pont entre les peticions que venen de la xarxa Tor i aquest servei que és intern a la xarxa Kubernetes.
</p><p>El resultat va consistir a aprofitar el propi proxy que té Tor. D’aquesta manera, Tor rep les peticions i s’encarrega de redireccionar-les, internament, cap al servei. La resposta del servei passa també per Tor. Així, l’accés a la pàgina web és exclusiu de Tor.
</p>
<h1><span class="mw-headline" id="Web_Service">Web Service</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=5" title="Edit section: Web Service">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=5" title="Edit section: Web Service">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Pel que fa al Web Service, voliem fer una web sencilla, ja que no era l’objectiu principal d’aquest treball, però tampoc trivial. Per això vam decidir fer una web amb un mapa i la informació relacionada del node que es connecta, per així demostrar que la ip del que es connecta al servei no és la del client. 
</p><p>Per fer tot això vam utilitzar dos recursos, el primer ip-api, una api per aconseguir la informació relacionada a la ip i el segon Leaflet, una llibreria open source de mapes interactius. No vam utilitzar el tipic mapa de Google Maps perquè creiem que trenca una mica amb tot aquest entorn de anonimat que hem creat. Apart també vam utilitzar Bootstrap, una biblioteca open source, per donar-li un look més vistós a la web. 
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:576px;"><a class="image" href="/pti/index.php/File:Web.jpg.jpg"><img alt="" class="thumbimage" data-file-height="307" data-file-width="574" decoding="async" height="307" src="/pti/images/9/9a/Web.jpg.jpg" width="574"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="/pti/index.php/File:Web.jpg.jpg" title="Enlarge"></a></div>Pàgina Web del Servei</div></div></div></div>
<h1><span id="Avaluació_de_Rendiment"></span><span class="mw-headline" id="Avaluaci.C3.B3_de_Rendiment">Avaluació de Rendiment</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=6" title="Edit section: Avaluació de Rendiment">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=6" title="Edit section: Avaluació de Rendiment">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Hem fet un petit anàlisi estadístic, per veure la latència que afegeix l'accés al servei des de dins de la xarxa Tor i des d'Internet. El resultat és que el temps d’accés mitjançant Tor és 2.385,27% vegades més lent que l’accés a partir d’Internet. No obstant això, la desviació del temps d’accés és molt similar proporcionalment en els dos casos. Per tant, Tor triga més, però el temps d'accés és bastant constant.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:608px;"><a class="image" href="/pti/index.php/File:Performance.jpg"><img alt="" class="thumbimage" data-file-height="362" data-file-width="606" decoding="async" height="362" src="/pti/images/0/05/Performance.jpg" width="606"/></a> <div class="thumbcaption"><div class="magnify"><a class="internal" href="/pti/index.php/File:Performance.jpg" title="Enlarge"></a></div>Gràfic del temps d'accés.</div></div></div></div>
<h1><span class="mw-headline" id="Conclusions">Conclusions</span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a class="mw-editsection-visualeditor" href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;veaction=edit&amp;section=7" title="Edit section: Conclusions">edit</a><span class="mw-editsection-divider"> | </span><a href="/pti/index.php?title=Categor%C3%ADa:SpyWaiter&amp;action=edit&amp;section=7" title="Edit section: Conclusions">edit source</a><span class="mw-editsection-bracket">]</span></span></h1>
<p>Amb aquest treball, doncs, hem demostrat que és possible tenir un servei web en un clúster Kubernetes dins de la xarxa Tor. No obstant això, cal tenir en compte la latència que afegeix la xarxa. El temps d’accés és bastant constant, així que un servei que no requereixi baixes latències podria plantejar-se seguir l’arquitectura que hem desenvolupat en aquest projecte. Sens dubte, les principals avantatges de Tor i Kubernetes - anonimat i escalabilitat - poden ser molt interessants i convenients per molts serveis.
</p>
<!-- 
NewPP limit report
Cached time: 20250710074821
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.017 seconds
Real time usage: 0.023 seconds
Preprocessor visited node count: 24/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
<!-- Saved in parser cache with key pti21:pcache:idhash:618-0!canonical and timestamp 20250710074821 and revision id 1337
 -->
</div>